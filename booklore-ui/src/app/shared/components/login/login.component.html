<div class="login-container">
  <div class="login-card-wrapper">
    <div class="login-card-border">
      <div class="login-card">
        <div class="login-header">
          <div class="logo-wrapper">
            <svg class="logo-icon" viewBox="0 0 126 126" fill="var(--primary-color)" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M59 4.79297C71.5051 11.5557 80 24.7854 80 40C80 40.5959 79.987 41.1888 79.9609 41.7783C79.8609 44.0406 81.7355 46 84 46C106.091 46 124 63.9086 124 86C124 108.091 106.091 126 84 126H10C4.47715 126 0 121.523 0 116V39.0068L0.0126953 38.9941C0.357624 25.0252 7.86506 12.8347 19 5.95215V63.832C19 64.8345 20.0676 65.4391 20.9121 64.9902L21.0771 64.8867L38.2227 52.3428C38.6819 52.0068 39.3064 52.0068 39.7656 52.3428L56.9229 64.8945L57.0879 64.998C57.9324 65.447 59 64.8423 59 63.8398V4.79297Z"/>
              <path
                d="M40 0C43.8745 0 47.6199 0.552381 51.1631 1.58008V50.9697L44.3926 46.0176L44.0879 45.8037C40.9061 43.6679 36.7098 43.7393 33.5957 46.0176L26.8369 50.9619V2.21875C30.9593 0.782634 35.3881 0 40 0Z"
                fill="white"/>
            </svg>
          </div>
          <h1 class="login-title">Welcome Back</h1>
          <p class="login-subtitle">Sign in to continue your journey</p>
        </div>

        @if (showOidcBypassInfo) {
          <div class="oidc-warning">
            <div class="warning-content">
              <div class="warning-header">
                <i class="pi pi-exclamation-triangle"></i>
                <span>OIDC Authentication Issues</span>
              </div>
              <p class="warning-message">{{ oidcBypassMessage }}</p>
              <div class="warning-actions">
                <p-button
                  size="small"
                  severity="warn"
                  label="Retry OIDC"
                  icon="pi pi-refresh"
                  (click)="retryOidc()"
                />
                <p-button
                  size="small"
                  severity="success"
                  label="Use Local Login"
                  icon="pi pi-times"
                  (click)="dismissOidcWarning()"
                />
              </div>
            </div>
          </div>
        }

        <form class="login-form" #loginForm="ngForm" (ngSubmit)="login()">
          <div class="form-field">
            <label for="username" class="form-label">
              <i class="pi pi-user"></i>
              <span>Username</span>
            </label>
            <input
              fluid
              pInputText
              id="username"
              name="username"
              required
              [(ngModel)]="username"
              placeholder="Enter your username"
              class="form-input"
              autocomplete="username"
            />
          </div>

          <div class="form-field">
            <label for="password" class="form-label">
              <i class="pi pi-lock"></i>
              <span>Password</span>
            </label>
            <p-password
              id="password"
              name="password"
              required
              [(ngModel)]="password"
              [feedback]="false"
              placeholder="Enter your password"
              [toggleMask]="true"
              [fluid]="true"
              autocomplete="current-password"
            ></p-password>
          </div>

          <p-button
            fluid
            type="submit"
            label="Sign In"
            icon="pi pi-sign-in"
            [disabled]="!loginForm.valid || !username || !password"
            class="login-button">
          </p-button>

          @if (errorMessage) {
            <div class="error-message">
              <p-message severity="error">{{ errorMessage }}</p-message>
            </div>
          }

          @if (oidcEnabled && !isOidcBypassed) {
            <div class="divider">
              <span>or continue with</span>
            </div>

            <p-button
              fluid
              severity="secondary"
              [label]="isOidcLoginInProgress ? 'Redirecting to ' + oidcName + '...' : oidcName"
              [icon]="isOidcLoginInProgress ? 'pi pi-spin pi-spinner' : 'pi pi-id-card'"
              [disabled]="isOidcLoginInProgress"
              (click)="loginWithOidc()"
              class="oidc-button"/>

            <div class="help-text">
              <button
                type="button"
                class="text-link"
                (click)="bypassOidc()">
                Having trouble with {{ oidcName }}? Use local login
              </button>
            </div>
          }

          @if (oidcEnabled && isOidcBypassed) {
            <div class="help-text">
              <button
                type="button"
                class="text-link primary"
                (click)="enableOidc()">
                Re-enable {{ oidcName }} login
              </button>
            </div>
          }
        </form>
      </div>
    </div>
  </div>
</div>
